<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kas Kecil - PT Tiga Serangkai Pustaka Mandiri</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    .table-container {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-6px);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }
    
    .gradient-1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-2 {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .gradient-3 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .gradient-4 {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    
    .gradient-5 {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .icon-box {
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      width: 60px;
      height: 60px;
      flex-shrink: 0;
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    .glow-effect {
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
    }
    
    .shimmer {
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-green-50 via-white to-cyan-50">
  <div id="app" class="h-full w-full overflow-auto"><!-- Login Page -->
   <div id="loginPage" class="min-h-full flex items-center justify-center p-4 bg-gradient-to-br from-emerald-500 via-green-400 to-teal-500 relative overflow-hidden"><!-- Animated Background Elements -->
    <div class="absolute top-0 left-0 w-96 h-96 bg-white rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-emerald-300 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse" style="animation-delay: 2s;"></div>
    <div class="absolute top-1/2 left-1/2 w-96 h-96 bg-green-300 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse" style="animation-delay: 4s;"></div><!-- Login Card -->
    <div class="bg-white backdrop-blur-2xl rounded-3xl shadow-2xl p-8 w-full max-w-md fade-in border-2 border-emerald-100 relative z-10">
     <div class="text-center mb-8"><!-- Animated Logo -->
      <div class="relative w-24 h-24 mx-auto mb-6">
       <div class="absolute inset-0 bg-gradient-to-br from-emerald-500 to-green-500 rounded-2xl shadow-2xl shadow-emerald-500/50 animate-spin" style="animation-duration: 3s;"></div>
       <div class="absolute inset-1 bg-white rounded-2xl flex items-center justify-center">
        <svg class="w-12 h-12 text-transparent bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
       </div>
      </div>
      <h1 id="loginTitle" class="text-4xl font-black bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent mb-1">SmartCash Tiga Serangkai</h1>
      <div class="h-1 w-20 bg-gradient-to-r from-emerald-600 to-green-600 rounded-full mx-auto mb-4"></div>
      <p id="loginCompany" class="text-gray-600 font-medium">PT Tiga Serangkai Pustaka Mandiri</p>
      <p class="text-sm text-gray-500 mt-1">üíº Sistem Manajemen Kas Kecil</p>
     </div>
     <div id="loginError" class="hidden bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-300 text-red-700 px-4 py-3 rounded-xl mb-4 text-sm shadow-md">
      <div class="flex items-center gap-2">
       <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
       </svg><span>‚ö†Ô∏è Username atau password salah. Silakan coba lagi.</span>
      </div>
     </div>
     <form id="loginForm" class="space-y-4">
      <div class="group"><label class="block text-sm font-bold text-gray-700 mb-2">üë§ Username</label>
       <div class="relative"><input type="text" id="username" placeholder="Masukkan username Anda" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all bg-white/80 hover:bg-white hover:border-emerald-300">
        <div class="absolute right-4 top-3.5 text-gray-400">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
         </svg>
        </div>
       </div>
      </div>
      <div class="group"><label class="block text-sm font-bold text-gray-700 mb-2">üîê Password</label>
       <div class="relative"><input type="password" id="password" placeholder="Masukkan password Anda" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all bg-white/80 hover:bg-white hover:border-emerald-300">
        <div class="absolute right-4 top-3.5 text-gray-400">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
         </svg>
        </div>
       </div>
      </div><button type="submit" class="w-full bg-gradient-to-r from-emerald-600 to-green-600 text-white py-3 rounded-xl font-bold hover:from-emerald-700 hover:to-green-700 transition-all shadow-lg shadow-emerald-600/50 hover:shadow-xl hover:shadow-emerald-600/60 transform hover:scale-105 duration-200 text-lg"> üöÄ Masuk Sekarang </button>
     </form><!-- Footer -->
     <div class="mt-8 text-center">
      <p class="text-xs text-gray-600"><span class="font-semibold">üîí Secure</span> ‚Ä¢ <span class="font-semibold">‚ö° Fast</span> ‚Ä¢ <span class="font-semibold">üíé Professional</span></p>
     </div>
    </div>
   </div><!-- Main Application -->
   <div id="mainApp" class="hidden h-full"><!-- Sidebar -->
    <div class="fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-white to-green-50 shadow-xl z-40 flex flex-col border-r-2 border-green-200">
     <div class="p-5 border-b border-gray-100">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-xl flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
       </div>
       <div>
        <h2 id="sidebarTitle" class="font-bold text-gray-800 text-sm">Kas Kecil</h2>
        <p class="text-xs text-gray-400">Imprest Fund</p>
       </div>
      </div>
     </div>
     <nav class="flex-1 p-4 space-y-1 overflow-y-auto scrollbar-thin"><button onclick="showPage('dashboard')" data-page="dashboard" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all bg-emerald-50 text-emerald-700">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
       </svg><span class="font-medium text-sm">Dashboard</span> </button> <button onclick="showPage('income')" data-page="income" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all text-gray-600 hover:bg-gray-50">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
       </svg><span class="font-medium text-sm">Pemasukan</span> </button> <button onclick="showPage('expense')" data-page="expense" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all text-gray-600 hover:bg-gray-50">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
       </svg><span class="font-medium text-sm">Pengeluaran</span> </button> <button onclick="showPage('weekly')" data-page="weekly" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all text-gray-600 hover:bg-gray-50">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
       </svg><span class="font-medium text-sm">Rekap Mingguan</span> </button> <button onclick="showPage('report')" data-page="report" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all text-gray-600 hover:bg-gray-50">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg><span class="font-medium text-sm">Buku Kas</span> </button> <button onclick="showPage('download')" data-page="download" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all text-gray-600 hover:bg-gray-50">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
       </svg><span class="font-medium text-sm">Download Laporan</span> </button>
     </nav>
     <div class="p-4 border-t border-gray-100"><button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
       </svg><span class="font-medium text-sm">Keluar</span> </button>
     </div>
    </div><!-- Main Content -->
    <div class="ml-64 min-h-full">
     <header class="bg-gradient-to-r from-white via-green-50 to-cyan-50/50 backdrop-blur-sm border-b-2 border-green-200 px-6 py-4 sticky top-0 z-30">
      <div class="flex items-center justify-between">
       <div>
        <h1 id="pageTitle" class="text-xl font-bold text-gray-800">Dashboard</h1>
        <p id="companyName" class="text-sm text-gray-500">PT Tiga Serangkai Pustaka Mandiri</p>
       </div>
       <div class="flex items-center gap-4">
        <div class="text-right">
         <p class="text-sm font-medium text-gray-800">Admin User</p>
         <p class="text-xs text-gray-400" id="currentDate"></p>
        </div>
        <div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center text-white font-bold">
         A
        </div>
       </div>
      </div>
     </header>
     <main class="p-6"><!-- Dashboard Page -->
      <div id="dashboardPage" class="page fade-in">
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-6">
        <div class="bg-white rounded-2xl p-6 shadow-md card-hover border border-purple-100 overflow-hidden relative">
         <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-1 opacity-10 rounded-full -mr-12 -mt-12"></div>
         <div class="flex items-center justify-between mb-4 relative z-10">
          <div class="icon-box gradient-1 text-white">
           <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
           </svg>
          </div><span class="text-xs font-bold bg-purple-100 text-purple-700 px-3 py-1.5 rounded-full">SALDO</span>
         </div>
         <p class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-purple-800 bg-clip-text text-transparent" id="totalBalance">Rp 0</p>
         <p class="text-sm text-gray-500 mt-2">üíº Saldo Kas Kecil</p>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow-md card-hover border border-blue-100 overflow-hidden relative">
         <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-3 opacity-10 rounded-full -mr-12 -mt-12"></div>
         <div class="flex items-center justify-between mb-4 relative z-10">
          <div class="icon-box gradient-3 text-white">
           <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
           </svg>
          </div><span class="text-xs font-bold bg-blue-100 text-blue-700 px-3 py-1.5 rounded-full">MASUK</span>
         </div>
         <p class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent" id="totalIncome">Rp 0</p>
         <p class="text-sm text-gray-500 mt-2">üìà Total Pemasukan</p>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow-md card-hover border border-orange-100 overflow-hidden relative">
         <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-5 opacity-10 rounded-full -mr-12 -mt-12"></div>
         <div class="flex items-center justify-between mb-4 relative z-10">
          <div class="icon-box gradient-5 text-white">
           <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
           </svg>
          </div><span class="text-xs font-bold bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full">MINGGU</span>
         </div>
         <p class="text-3xl font-bold bg-gradient-to-r from-orange-500 to-yellow-500 bg-clip-text text-transparent" id="weeklyExpense">Rp 0</p>
         <p class="text-sm text-gray-500 mt-2">üìÖ Pengeluaran Minggu Ini</p>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow-md card-hover border border-pink-100 overflow-hidden relative">
         <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-2 opacity-10 rounded-full -mr-12 -mt-12"></div>
         <div class="flex items-center justify-between mb-4 relative z-10">
          <div class="icon-box gradient-2 text-white">
           <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
           </svg>
          </div><span class="text-xs font-bold bg-pink-100 text-pink-700 px-3 py-1.5 rounded-full">BULAN</span>
         </div>
         <p class="text-3xl font-bold bg-gradient-to-r from-pink-600 to-rose-600 bg-clip-text text-transparent" id="monthlyExpense">Rp 0</p>
         <p class="text-sm text-gray-500 mt-2">üìä Pengeluaran Bulan Ini</p>
        </div>
       </div><!-- Recent Transactions -->
       <div class="bg-white rounded-2xl shadow-md border border-gray-100 p-6">
        <div class="flex items-center gap-3 mb-5">
         <div class="gradient-4 icon-box text-white">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
          </svg>
         </div>
         <h3 class="text-lg font-bold text-gray-800">Transaksi Terakhir</h3>
        </div>
        <div class="table-container scrollbar-thin">
         <table class="w-full text-sm">
          <thead class="bg-gradient-to-r from-gray-50 to-gray-100 sticky top-0">
           <tr>
            <th class="text-left px-4 py-3 font-semibold text-gray-700 border-b-2 border-gray-200">Tanggal</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700 border-b-2 border-gray-200">Kategori</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700 border-b-2 border-gray-200">Keterangan</th>
            <th class="text-right px-4 py-3 font-semibold text-gray-700 border-b-2 border-gray-200">Nominal</th>
           </tr>
          </thead>
          <tbody id="recentTransactions">
           <tr>
            <td colspan="4" class="text-center py-8 text-gray-400">Belum ada transaksi</td>
           </tr>
          </tbody>
         </table>
        </div>
       </div>
      </div><!-- Income Page -->
      <div id="incomePage" class="page hidden fade-in">
       <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><!-- Form -->
        <div class="bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-sm border-2 border-green-200 p-5">
         <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg> Input Pemasukan</h3>
         <form id="incomeForm" class="space-y-4">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label> <input type="date" id="incomeDate" required class="w-full px-3 py-2 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm bg-green-50/50">
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Sumber Pemasukan</label> <input type="text" id="incomeSource" placeholder="Contoh: Pengisian Dana" required class="w-full px-3 py-2 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm bg-green-50/50">
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Nominal</label> <input type="text" id="incomeAmount" placeholder="0" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm text-right">
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Keterangan</label> <textarea id="incomeDesc" rows="2" placeholder="Keterangan tambahan..." class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm resize-none"></textarea>
          </div><button type="submit" class="w-full bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 text-white py-2.5 rounded-xl font-semibold hover:from-green-600 hover:via-emerald-600 hover:to-teal-600 transition-all text-sm shadow-md shadow-green-400/30"> Simpan Pemasukan </button>
         </form>
        </div><!-- Table -->
        <div class="lg:col-span-2 bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-sm border-2 border-green-200 p-5">
         <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-gray-800">Daftar Pemasukan</h3><input type="text" id="incomeSearch" placeholder="Cari..." class="px-3 py-2 border-2 border-green-200 rounded-xl text-sm w-48 focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-green-50/50">
         </div>
         <div class="table-container scrollbar-thin">
          <table class="w-full text-sm">
           <thead class="bg-gradient-to-r from-green-100 to-emerald-100 sticky top-0">
            <tr>
             <th class="text-left px-3 py-2.5 font-semibold text-green-800 border-b-2 border-green-300 cursor-pointer hover:bg-green-200" onclick="sortTable('income', 'date')">Tanggal ‚Üï</th>
             <th class="text-left px-3 py-2.5 font-semibold text-green-800 border-b-2 border-green-300">Sumber</th>
             <th class="text-left px-3 py-2.5 font-semibold text-green-800 border-b-2 border-green-300">Keterangan</th>
             <th class="text-left px-3 py-2.5 font-semibold text-green-800 border-b-2 border-green-300 cursor-pointer hover:bg-green-200" onclick="sortTable('income', 'amount')">Nominal ‚Üï</th>
             <th class="text-center px-3 py-2.5 font-semibold text-green-800 border-b-2 border-green-300">Aksi</th>
            </tr>
           </thead>
           <tbody id="incomeTable">
            <tr>
             <td colspan="5" class="text-center py-8 text-gray-400">Belum ada data pemasukan</td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
       </div>
      </div><!-- Expense Page -->
      <div id="expensePage" class="page hidden fade-in">
       <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><!-- Form -->
        <div class="bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-sm border-2 border-green-200 p-5">
         <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-rose-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
          </svg> Input Pengeluaran</h3>
         <form id="expenseForm" class="space-y-4">
          <div><label class="block text-sm font-medium text-gray-700 mb-1">No. Transaksi (Opsional)</label> <input type="text" id="expenseNo" placeholder="Contoh: KWT-001" class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label> <input type="date" id="expenseDate" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label> <select id="expenseCategory" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm bg-white"> <option value="">Pilih Kategori</option> <option value="Listrik">Listrik</option> <option value="Air">Air</option> <option value="Sampah">Sampah</option> <option value="Minum">Minum</option> <option value="Konsumsi">Konsumsi</option> <option value="WiFi/Internet">WiFi/Internet</option> <option value="Transportasi">Transportasi</option> <option value="BBM">BBM</option> <option value="Pengiriman">Pengiriman</option> <option value="ATK">ATK</option> <option value="Pemasaran">Pemasaran</option> <option value="Pemeliharaan">Pemeliharaan</option> <option value="Elektronik">Elektronik</option> <option value="Lainnya">Lainnya</option> </select>
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Uraian</label> <input type="text" id="expenseDesc" placeholder="Deskripsi pengeluaran" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div><label class="block text-sm font-medium text-gray-700 mb-1">Nominal</label> <input type="text" id="expenseAmount" placeholder="0" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm text-right">
          </div>
          <div class="bg-slate-50 rounded-xl p-3">
           <p class="text-sm text-gray-600">Saldo saat ini: <span class="font-bold text-emerald-600" id="currentBalance">Rp 0</span></p>
          </div><button type="submit" class="w-full bg-gradient-to-r from-rose-500 to-pink-500 text-white py-2.5 rounded-xl font-semibold hover:from-rose-600 hover:to-pink-600 transition-all text-sm"> Simpan Pengeluaran </button>
         </form>
        </div><!-- Table -->
        <div class="lg:col-span-2 bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-sm border-2 border-green-200 p-5">
         <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-gray-800">Daftar Pengeluaran</h3><input type="text" id="expenseSearch" placeholder="Cari..." class="px-3 py-2 border border-gray-200 rounded-xl text-sm w-48 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
         </div>
         <div class="table-container scrollbar-thin">
          <table class="w-full text-sm">
           <thead class="bg-emerald-50 sticky top-0">
            <tr>
             <th class="text-left px-3 py-2.5 font-semibold text-emerald-800 border-b border-emerald-100 cursor-pointer hover:bg-emerald-100" onclick="sortTable('expense', 'date')">Tanggal ÔøΩÔøΩÔøΩ</th>
             <th class="text-left px-3 py-2.5 font-semibold text-emerald-800 border-b border-emerald-100">Kategori</th>
             <th class="text-left px-3 py-2.5 font-semibold text-emerald-800 border-b border-emerald-100">Uraian</th>
             <th class="text-left px-3 py-2.5 font-semibold text-emerald-800 border-b border-emerald-100 cursor-pointer hover:bg-emerald-100" onclick="sortTable('expense', 'amount')">Nominal ‚Üï</th>
             <th class="text-right px-3 py-2.5 font-semibold text-emerald-800 border-b border-emerald-100">Saldo</th>
             <th class="text-center px-3 py-2.5 font-semibold text-emerald-800 border-b border-emerald-100">Aksi</th>
            </tr>
           </thead>
           <tbody id="expenseTable">
            <tr>
             <td colspan="6" class="text-center py-8 text-gray-400">Belum ada data pengeluaran</td>
            </tr>
           </tbody>
           <tfoot class="bg-emerald-100 sticky bottom-0">
            <tr>
             <td colspan="3" class="px-3 py-2.5 font-semibold text-emerald-800 border-t-2 border-emerald-300 text-right">TOTAL:</td>
             <td class="px-3 py-2.5 font-semibold text-emerald-800 border-t-2 border-emerald-300 text-left" id="expenseTotalNominal">Rp 0</td>
             <td colspan="2" class="px-3 py-2.5 border-t-2 border-emerald-300"></td>
            </tr>
           </tfoot>
          </table>
         </div>
        </div>
       </div>
      </div><!-- Weekly Recap Page -->
      <div id="weeklyPage" class="page hidden fade-in">
       <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
         <h3 class="text-lg font-bold text-gray-800">Rekap Pengeluaran Mingguan</h3>
         <div class="flex items-center gap-3"><select id="weeklyMonth" class="px-3 py-2 border border-gray-200 rounded-xl text-sm bg-white focus:ring-2 focus:ring-emerald-500"> <option value="1">Januari</option> <option value="2">Februari</option> <option value="3">Maret</option> <option value="4">April</option> <option value="5">Mei</option> <option value="6">Juni</option> <option value="7">Juli</option> <option value="8">Agustus</option> <option value="9">September</option> <option value="10">Oktober</option> <option value="11">November</option> <option value="12">Desember</option> </select>
          <div class="relative w-32"><input type="text" id="weeklyYear" placeholder="Tahun" class="w-full px-3 py-2 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
           <div id="weeklyYearDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-48 overflow-y-auto"></div>
          </div>
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"><button onclick="selectWeek(1)" class="week-card bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border-2 border-blue-200 hover:border-blue-400 hover:shadow-lg transition-all cursor-pointer"> <p class="text-sm text-blue-600 font-medium mb-1">Minggu ke-1</p><p class="text-xl font-bold text-blue-800" id="week1Total">Rp 0</p><p class="text-xs text-blue-500 mt-2">Klik untuk detail ‚Üí</p></button> <button onclick="selectWeek(2)" class="week-card bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 border-2 border-emerald-200 hover:border-emerald-400 hover:shadow-lg transition-all cursor-pointer"> <p class="text-sm text-emerald-600 font-medium mb-1">Minggu ke-2</p><p class="text-xl font-bold text-emerald-800" id="week2Total">Rp 0</p><p class="text-xs text-emerald-500 mt-2">Klik untuk detail ‚Üí</p></button> <button onclick="selectWeek(3)" class="week-card bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border-2 border-amber-200 hover:border-amber-400 hover:shadow-lg transition-all cursor-pointer"> <p class="text-sm text-amber-600 font-medium mb-1">Minggu ke-3</p><p class="text-xl font-bold text-amber-800" id="week3Total">Rp 0</p><p class="text-xs text-amber-500 mt-2">Klik untuk detail ‚Üí</p></button> <button onclick="selectWeek(4)" class="week-card bg-gradient-to-br from-rose-50 to-pink-50 rounded-xl p-4 border-2 border-rose-200 hover:border-rose-400 hover:shadow-lg transition-all cursor-pointer"> <p class="text-sm text-rose-600 font-medium mb-1">Minggu ke-4</p><p class="text-xl font-bold text-rose-800" id="week4Total">Rp 0</p><p class="text-xs text-rose-500 mt-2">Klik untuk detail ‚Üí</p></button>
        </div>
        <div id="weeklyTableContainer" class="hidden">
         <div class="flex items-center justify-between mb-4">
          <h4 class="text-lg font-bold text-gray-800">Detail Minggu ke-<span id="selectedWeekNum">1</span></h4><button onclick="closeWeeklyDetail()" class="text-gray-400 hover:text-gray-600">
           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
           </svg></button>
         </div>
         <div class="table-container scrollbar-thin">
          <table class="w-full text-sm">
           <thead class="bg-blue-50 sticky top-0">
            <tr>
             <th class="text-left px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-100">Tanggal</th>
             <th class="text-left px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-100">Kategori</th>
             <th class="text-left px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-100">Uraian</th>
             <th class="text-right px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-100">Nominal</th>
            </tr>
           </thead>
           <tbody id="weeklyDetailTable">
            <tr>
             <td colspan="4" class="text-center py-8 text-gray-400">Tidak ada data</td>
            </tr>
           </tbody>
           <tfoot class="bg-blue-100 sticky bottom-0">
            <tr>
             <td colspan="3" class="px-3 py-2.5 font-semibold text-blue-800 border-t-2 border-blue-300 text-right">TOTAL:</td>
             <td class="px-3 py-2.5 font-semibold text-blue-800 border-t-2 border-blue-300 text-right" id="weeklyDetailTotal">Rp 0</td>
            </tr>
           </tfoot>
          </table>
         </div>
        </div>
       </div>
      </div><!-- Report/Buku Kas Page -->
      <div id="reportPage" class="page hidden fade-in">
       <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
         <h3 class="text-lg font-bold text-gray-800">Buku Kas Kecil</h3>
         <div class="flex items-center gap-3"><select id="reportWeek" class="px-3 py-2 border border-gray-200 rounded-xl text-sm bg-white focus:ring-2 focus:ring-emerald-500"> <option value="0">Semua Minggu</option> <option value="1">Minggu ke-1</option> <option value="2">Minggu ke-2</option> <option value="3">Minggu ke-3</option> <option value="4">Minggu ke-4</option> </select> <select id="reportMonth" class="px-3 py-2 border border-gray-200 rounded-xl text-sm bg-white focus:ring-2 focus:ring-emerald-500"> <option value="1">Januari</option> <option value="2">Februari</option> <option value="3">Maret</option> <option value="4">April</option> <option value="5">Mei</option> <option value="6">Juni</option> <option value="7">Juli</option> <option value="8">Agustus</option> <option value="9">September</option> <option value="10">Oktober</option> <option value="11">November</option> <option value="12">Desember</option> </select>
          <div class="relative w-32"><input type="text" id="reportYear" placeholder="Tahun" class="w-full px-3 py-2 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
           <div id="reportYearDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-48 overflow-y-auto"></div>
          </div>
         </div>
        </div>
        <div class="table-container scrollbar-thin mb-6">
         <table class="w-full text-sm">
          <thead class="bg-gradient-to-r from-blue-50 to-purple-50 sticky top-0">
           <tr>
            <th class="text-center px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-200 w-12">No</th>
            <th class="text-left px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-200">Tanggal</th>
            <th class="text-left px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-200">Uraian</th>
            <th class="text-right px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-200">Debit</th>
            <th class="text-right px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-200">Kredit</th>
            <th class="text-right px-3 py-2.5 font-semibold text-blue-800 border-b border-blue-200">Saldo</th>
           </tr>
          </thead>
          <tbody id="reportTable">
           <tr>
            <td colspan="6" class="text-center py-8 text-gray-400">Tidak ada data untuk periode ini</td>
           </tr>
          </tbody>
          <tfoot class="bg-blue-100 sticky bottom-0">
           <tr>
            <td colspan="3" class="px-3 py-2.5 font-semibold text-blue-800 border-t-2 border-blue-300 text-right">TOTAL:</td>
            <td class="px-3 py-2.5 font-semibold text-blue-800 border-t-2 border-blue-300 text-right" id="reportTotalDebit">Rp 0</td>
            <td class="px-3 py-2.5 font-semibold text-blue-800 border-t-2 border-blue-300 text-right" id="reportTotalKredit">Rp 0</td>
            <td class="px-3 py-2.5 font-semibold text-blue-800 border-t-2 border-blue-300 text-right" id="reportTotalBalance">Rp 0</td>
           </tr>
          </tfoot>
         </table>
        </div>
       </div>
      </div><!-- Download Page -->
      <div id="downloadPage" class="page hidden fade-in">
       <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
        <h3 class="text-lg font-bold text-gray-800 mb-6">Download Laporan</h3>
        <div class="flex flex-wrap items-center gap-4 mb-6"><select id="downloadMonth" class="px-3 py-2 border border-gray-200 rounded-xl text-sm bg-white focus:ring-2 focus:ring-emerald-500"> <option value="1">Januari</option> <option value="2">Februari</option> <option value="3">Maret</option> <option value="4">April</option> <option value="5">Mei</option> <option value="6">Juni</option> <option value="7">Juli</option> <option value="8">Agustus</option> <option value="9">September</option> <option value="10">Oktober</option> <option value="11">November</option> <option value="12">Desember</option> </select>
         <div class="relative w-32"><input type="text" id="downloadYear" placeholder="Tahun" class="w-full px-3 py-2 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
          <div id="downloadYearDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-xl shadow-lg z-50 max-h-48 overflow-y-auto"></div>
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
         <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 border border-blue-100">
          <div class="flex items-center gap-3 mb-4">
           <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
           </div><span class="font-semibold text-blue-800">Minggu ke-1</span>
          </div>
          <div class="flex flex-col gap-2"><button onclick="downloadReportFormat(1, 'pdf')" class="w-full bg-blue-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-blue-600 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg> PDF </button> <button onclick="downloadReportFormat(1, 'word')" class="w-full bg-blue-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg> Word </button>
          </div>
         </div>
         <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-5 border border-emerald-100">
          <div class="flex items-center gap-3 mb-4">
           <div class="w-10 h-10 bg-emerald-500 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
           </div><span class="font-semibold text-emerald-800">Minggu ke-2</span>
          </div>
          <div class="flex flex-col gap-2"><button onclick="downloadReportFormat(2, 'pdf')" class="w-full bg-emerald-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-emerald-600 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg> PDF </button> <button onclick="downloadReportFormat(2, 'word')" class="w-full bg-emerald-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-emerald-700 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg> Word </button>
          </div>
         </div>
         <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-5 border border-amber-100">
          <div class="flex items-center gap-3 mb-4">
           <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
           </div><span class="font-semibold text-amber-800">Minggu ke-3</span>
          </div>
          <div class="flex flex-col gap-2"><button onclick="downloadReportFormat(3, 'pdf')" class="w-full bg-amber-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-amber-600 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg> PDF </button> <button onclick="downloadReportFormat(3, 'word')" class="w-full bg-amber-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-amber-700 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg> Word </button>
          </div>
         </div>
         <div class="bg-gradient-to-br from-rose-50 to-pink-50 rounded-xl p-5 border border-rose-100">
          <div class="flex items-center gap-3 mb-4">
           <div class="w-10 h-10 bg-rose-500 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
           </div><span class="font-semibold text-rose-800">Minggu ke-4</span>
          </div>
          <div class="flex flex-col gap-2"><button onclick="downloadReportFormat(4, 'pdf')" class="w-full bg-rose-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-rose-600 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg> PDF </button> <button onclick="downloadReportFormat(4, 'word')" class="w-full bg-rose-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-rose-700 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg> Word </button>
          </div>
         </div>
         <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-5 border border-purple-100 md:col-span-2 lg:col-span-2">
          <div class="flex items-center gap-3 mb-4">
           <div class="w-10 h-10 bg-purple-500 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
           </div><span class="font-semibold text-purple-800">Rekap Bulanan</span>
          </div>
          <div class="flex flex-col gap-2"><button onclick="downloadReportFormat(0, 'pdf')" class="w-full bg-purple-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-purple-600 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg> Download PDF </button> <button onclick="downloadReportFormat(0, 'word')" class="w-full bg-purple-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-all flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg> Download Word </button>
          </div>
         </div>
        </div>
       </div>
      </div>
     </main>
    </div>
   </div><!-- Edit Modal -->
   <div id="editModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md fade-in">
     <div class="p-5 border-b border-gray-100">
      <h3 id="editModalTitle" class="text-lg font-bold text-gray-800">Edit Data</h3>
     </div>
     <form id="editForm" class="p-5 space-y-4"><input type="hidden" id="editId"> <input type="hidden" id="editType">
      <div id="editFields"></div>
      <div class="flex gap-3"><button type="button" onclick="closeEditModal()" class="flex-1 px-4 py-2.5 border border-gray-200 rounded-xl text-gray-600 font-medium hover:bg-gray-50 transition-all"> Batal </button> <button type="submit" class="flex-1 px-4 py-2.5 bg-emerald-500 text-white rounded-xl font-medium hover:bg-emerald-600 transition-all"> Simpan </button>
      </div>
     </form>
    </div>
   </div><!-- Delete Confirmation Modal -->
   <div id="deleteModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm fade-in">
     <div class="p-6 text-center">
      <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
       <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
       </svg>
      </div>
      <h3 class="text-lg font-bold text-gray-800 mb-2">Hapus Data?</h3>
      <p class="text-gray-500 text-sm mb-6">Data yang dihapus tidak dapat dikembalikan. Apakah Anda yakin?</p>
      <div class="flex gap-3"><button onclick="closeDeleteModal()" class="flex-1 px-4 py-2.5 border border-gray-200 rounded-xl text-gray-600 font-medium hover:bg-gray-50 transition-all"> Batal </button> <button onclick="confirmDelete()" class="flex-1 px-4 py-2.5 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-all"> Hapus </button>
      </div>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-4 right-4 z-50 hidden">
    <div class="bg-gray-800 text-white px-5 py-3 rounded-xl shadow-lg flex items-center gap-3 fade-in">
     <svg id="toastIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
     </svg><span id="toastMessage">Berhasil!</span>
    </div>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      company_name: 'PT Tiga Serangkai Pustaka Mandiri',
      app_title: 'SmartCash Tiga Serangkai'
    };
    
    let config = { ...defaultConfig };
    let allData = [];
    let deleteTarget = null;
    let isLoggedIn = false;
    let sortConfig = { income: { field: 'date', asc: false }, expense: { field: 'date', asc: false } };
    
    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          updateUI();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['company_name', cfg.company_name || defaultConfig.company_name],
          ['app_title', cfg.app_title || defaultConfig.app_title]
        ])
      });
    }
    
    // Initialize Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        renderAll();
      }
    };
    
    async function initDataSDK() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }
    }
    
    initDataSDK();
    
    // UI Update function
    function updateUI() {
      const companyName = config.company_name || defaultConfig.company_name;
      const appTitle = config.app_title || defaultConfig.app_title;
      
      document.getElementById('loginTitle').textContent = appTitle;
      document.getElementById('loginCompany').textContent = companyName;
      document.getElementById('sidebarTitle').textContent = appTitle.split(' ').slice(0, 2).join(' ');
      document.getElementById('companyName').textContent = companyName;
    }
    
    
    // Currency functions
    function formatRupiah(num) {
      return 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }
    
    function parseRupiah(str) {
      // For number inputs, just convert to integer
      return parseInt(str) || 0;
    }
    
    function formatCurrency(str) {
      // Remove non-digits
      const num = str.replace(/\D/g, '');
      if (!num) return '';
      // Add dots every 3 digits from right
      return num.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }
    
    function parseCurrency(str) {
      // Remove dots to get the number
      return parseInt(str.replace(/\./g, '')) || 0;
    }
    
    // Format date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });
    }
    
    // Get current date string
    function getCurrentDate() {
      return new Date().toISOString().split('T')[0];
    }
    
    // Login handling
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (username === 'admin1' && password === 'ADMIN1') {
        isLoggedIn = true;
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        document.getElementById('loginError').classList.add('hidden');
        showToast('Login berhasil! Selamat datang.', 'success');
        renderAll();
      } else {
        document.getElementById('loginError').classList.remove('hidden');
      }
    });
    
    function logout() {
      isLoggedIn = false;
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      showToast('Anda telah keluar dari sistem.', 'info');
    }
    
    // Page navigation
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(pageName + 'Page').classList.remove('hidden');
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('bg-emerald-50', 'text-emerald-700');
        btn.classList.add('text-gray-600', 'hover:bg-gray-50');
      });
      
      const activeBtn = document.querySelector(`[data-page="${pageName}"]`);
      if (activeBtn) {
        activeBtn.classList.add('bg-emerald-50', 'text-emerald-700');
        activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-50');
      }
      
      const titles = {
        dashboard: 'Dashboard',
        income: 'Pemasukan Kas Kecil',
        expense: 'Pengeluaran Kas Kecil',
        weekly: 'Rekap Mingguan',
        report: 'Buku Kas Kecil',
        download: 'Download Laporan'
      };
      document.getElementById('pageTitle').textContent = titles[pageName] || 'Dashboard';
    }
    
    // Initialize
    initYearDropdowns();
    initDates();
    updateUI();
    document.getElementById('incomeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (allData.length >= 999) {
        showToast('Batas maksimum 999 data tercapai!', 'error');
        return;
      }
      
      const data = {
        type: 'income',
        date: document.getElementById('incomeDate').value,
        source: document.getElementById('incomeSource').value,
        category: '',
        description: document.getElementById('incomeDesc').value || '-',
        amount: parseCurrency(document.getElementById('incomeAmount').value) || 0,
        transaction_number: '',
        balance_after: 0,
        created_at: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create(data);
        if (result.isOk) {
          showToast('Pemasukan berhasil disimpan!', 'success');
          this.reset();
          document.getElementById('incomeDate').value = getCurrentDate();
        } else {
          showToast('Gagal menyimpan data!', 'error');
        }
      }
    });
    
    // Add input formatter for income amount
    document.getElementById('incomeAmount').addEventListener('input', function(e) {
      const formatted = formatCurrency(this.value);
      this.value = formatted;
    });
    
    // Expense form handling
    document.getElementById('expenseForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (allData.length >= 999) {
        showToast('Batas maksimum 999 data tercapai!', 'error');
        return;
      }
      
      const amount = parseCurrency(document.getElementById('expenseAmount').value) || 0;
      const currentBalance = calculateBalance();
      
      if (amount > currentBalance) {
        showToast('Saldo tidak mencukupi!', 'error');
        return;
      }
      
      const data = {
        type: 'expense',
        date: document.getElementById('expenseDate').value,
        source: '',
        category: document.getElementById('expenseCategory').value,
        description: document.getElementById('expenseDesc').value,
        amount: amount,
        transaction_number: document.getElementById('expenseNo').value || '',
        balance_after: currentBalance - amount,
        created_at: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create(data);
        if (result.isOk) {
          showToast('Pengeluaran berhasil disimpan!', 'success');
          this.reset();
          document.getElementById('expenseDate').value = getCurrentDate();
        } else {
          showToast('Gagal menyimpan data!', 'error');
        }
      }
    });
    
    // Add input formatter for expense amount
    document.getElementById('expenseAmount').addEventListener('input', function(e) {
      const formatted = formatCurrency(this.value);
      this.value = formatted;
    });
    
    // Calculate balance
    function calculateBalance() {
      const totalIncome = allData.filter(d => d.type === 'income').reduce((sum, d) => sum + d.amount, 0);
      const totalExpense = allData.filter(d => d.type === 'expense').reduce((sum, d) => sum + d.amount, 0);
      return totalIncome - totalExpense;
    }
    
    // Get week number of month
    function getWeekOfMonth(date) {
      const d = new Date(date);
      const day = d.getDate();
      if (day <= 7) return 1;
      if (day <= 14) return 2;
      if (day <= 21) return 3;
      return 4;
    }
    
    // Render all data
    function renderAll() {
      renderDashboard();
      renderIncomeTable();
      renderExpenseTable();
      renderWeeklyRecap();
      renderReport();
      updateCurrentBalance();
      
      document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', { 
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
      });
    }
    
    function updateCurrentBalance() {
      const balance = calculateBalance();
      document.getElementById('currentBalance').textContent = formatRupiah(balance);
    }
    
    function renderDashboard() {
      const totalIncome = allData.filter(d => d.type === 'income').reduce((sum, d) => sum + d.amount, 0);
      const totalExpense = allData.filter(d => d.type === 'expense').reduce((sum, d) => sum + d.amount, 0);
      const balance = totalIncome - totalExpense;
      
      // Weekly and monthly calculations
      const now = new Date();
      const startOfWeek = new Date(now);
      startOfWeek.setDate(now.getDate() - now.getDay());
      
      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
      
      const weeklyExpense = allData.filter(d => {
        if (d.type !== 'expense') return false;
        const date = new Date(d.date);
        return date >= startOfWeek;
      }).reduce((sum, d) => sum + d.amount, 0);
      
      const monthlyExpense = allData.filter(d => {
        if (d.type !== 'expense') return false;
        const date = new Date(d.date);
        return date >= startOfMonth;
      }).reduce((sum, d) => sum + d.amount, 0);
      
      document.getElementById('totalBalance').textContent = formatRupiah(balance);
      document.getElementById('totalIncome').textContent = formatRupiah(totalIncome);
      document.getElementById('weeklyExpense').textContent = formatRupiah(weeklyExpense);
      document.getElementById('monthlyExpense').textContent = formatRupiah(monthlyExpense);
      
      // Recent transactions
      const recent = [...allData].sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).slice(0, 10);
      const tbody = document.getElementById('recentTransactions');
      
      if (recent.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-400">Belum ada transaksi</td></tr>';
      } else {
        tbody.innerHTML = recent.map((item, i) => `
          <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">
            <td class="px-4 py-2.5 border-b border-gray-100">${formatDate(item.date)}</td>
            <td class="px-4 py-2.5 border-b border-gray-100">
              <span class="px-2 py-1 rounded-lg text-xs font-medium ${item.type === 'income' ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-700'}">
                ${item.type === 'income' ? 'Pemasukan' : (item.category || 'Pengeluaran')}
              </span>
            </td>
            <td class="px-4 py-2.5 border-b border-gray-100">${item.type === 'income' ? item.source : item.description}</td>
            <td class="px-4 py-2.5 border-b border-gray-100 text-right font-medium ${item.type === 'income' ? 'text-emerald-600' : 'text-rose-600'}">
              ${item.type === 'income' ? '+' : '-'}${formatRupiah(item.amount)}
            </td>
          </tr>
        `).join('');
      }
    }
    
    function renderIncomeTable() {
      const searchTerm = document.getElementById('incomeSearch').value.toLowerCase();
      let incomes = allData.filter(d => d.type === 'income');
      
      if (searchTerm) {
        incomes = incomes.filter(d => {
          const sourceLower = d.source.toLowerCase();
          const descLower = d.description.toLowerCase();
          const dateLower = formatDate(d.date).toLowerCase();
          return sourceLower.includes(searchTerm) || 
                 descLower.includes(searchTerm) ||
                 dateLower.includes(searchTerm);
        });
      }
      
      // Sort
      const { field, asc } = sortConfig.income;
      incomes.sort((a, b) => {
        let valA = field === 'amount' ? a.amount : new Date(a.date);
        let valB = field === 'amount' ? b.amount : new Date(b.date);
        return asc ? valA - valB : valB - valA;
      });
      
      const tbody = document.getElementById('incomeTable');
      
      if (incomes.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-400">Belum ada data pemasukan</td></tr>';
      } else {
        tbody.innerHTML = incomes.map((item, i) => `
          <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-emerald-50 transition-colors">
            <td class="px-3 py-2 border-b border-gray-100">${formatDate(item.date)}</td>
            <td class="px-3 py-2 border-b border-gray-100">${item.source}</td>
            <td class="px-3 py-2 border-b border-gray-100 text-gray-600">${item.description}</td>
            <td class="px-3 py-2 border-b border-gray-100 font-medium text-emerald-600">${formatRupiah(item.amount)}</td>
            <td class="px-3 py-2 border-b border-gray-100 text-center">
              <div class="flex items-center justify-center gap-1">
                <button onclick="openEditModal('${item.__backendId}', 'income')" class="p-1.5 text-blue-500 hover:bg-blue-100 rounded-lg transition-all" title="Edit">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                </button>
                <button onclick="openDeleteModal('${item.__backendId}')" class="p-1.5 text-red-500 hover:bg-red-100 rounded-lg transition-all" title="Hapus">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `).join('');
      }
    }
    
    function renderExpenseTable() {
      const searchTerm = document.getElementById('expenseSearch').value.toLowerCase();
      let expenses = allData.filter(d => d.type === 'expense');
      
      if (searchTerm) {
        expenses = expenses.filter(d => {
          const categoryLower = d.category.toLowerCase();
          const descLower = d.description.toLowerCase();
          const dateLower = formatDate(d.date).toLowerCase();
          return categoryLower.includes(searchTerm) || 
                 descLower.includes(searchTerm) ||
                 dateLower.includes(searchTerm);
        });
      }
      
      // Sort
      const { field, asc } = sortConfig.expense;
      expenses.sort((a, b) => {
        let valA = field === 'amount' ? a.amount : new Date(a.date);
        let valB = field === 'amount' ? b.amount : new Date(b.date);
        return asc ? valA - valB : valB - valA;
      });
      
      // Calculate running balance
      const totalIncome = allData.filter(d => d.type === 'income').reduce((sum, d) => sum + d.amount, 0);
      let runningBalance = totalIncome;
      
      // Sort by date for balance calculation
      const sortedExpenses = [...allData.filter(d => d.type === 'expense')].sort((a, b) => new Date(a.date) - new Date(b.date));
      const balanceMap = {};
      sortedExpenses.forEach(exp => {
        runningBalance -= exp.amount;
        balanceMap[exp.__backendId] = runningBalance;
      });
      
      // Calculate total nominal
      const totalNominal = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      document.getElementById('expenseTotalNominal').textContent = formatRupiah(totalNominal);
      
      const tbody = document.getElementById('expenseTable');
      
      if (expenses.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-400">Belum ada data pengeluaran</td></tr>';
      } else {
        tbody.innerHTML = expenses.map((item, i) => {
          const amountClass = item.amount < 100000 ? 'text-emerald-600' : item.amount < 500000 ? 'text-amber-600' : 'text-rose-600';
          return `
            <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-emerald-50 transition-colors">
              <td class="px-3 py-2 border-b border-gray-100">${formatDate(item.date)}</td>
              <td class="px-3 py-2 border-b border-gray-100">
                <span class="px-2 py-1 bg-slate-100 rounded-lg text-xs font-medium">${item.category}</span>
              </td>
              <td class="px-3 py-2 border-b border-gray-100 text-gray-600">${item.description}</td>
              <td class="px-3 py-2 border-b border-gray-100 font-medium ${amountClass}">${formatRupiah(item.amount)}</td>
              <td class="px-3 py-2 border-b border-gray-100 text-right text-gray-600">${formatRupiah(balanceMap[item.__backendId] || 0)}</td>
              <td class="px-3 py-2 border-b border-gray-100 text-center">
                <div class="flex items-center justify-center gap-1">
                  <button onclick="openEditModal('${item.__backendId}', 'expense')" class="p-1.5 text-blue-500 hover:bg-blue-100 rounded-lg transition-all" title="Edit">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  </button>
                  <button onclick="openDeleteModal('${item.__backendId}')" class="p-1.5 text-red-500 hover:bg-red-100 rounded-lg transition-all" title="Hapus">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }
    }
    
    function renderWeeklyRecap() {
      const month = parseInt(document.getElementById('weeklyMonth').value);
      const year = parseInt(document.getElementById('weeklyYear').value);
      
      const expenses = allData.filter(d => {
        if (d.type !== 'expense') return false;
        const date = new Date(d.date);
        return date.getMonth() + 1 === month && date.getFullYear() === year;
      });
      
      const weeks = [0, 0, 0, 0];
      
      expenses.forEach(exp => {
        const weekNum = getWeekOfMonth(exp.date) - 1;
        weeks[weekNum] += exp.amount;
      });
      
      document.getElementById('week1Total').textContent = formatRupiah(weeks[0]);
      document.getElementById('week2Total').textContent = formatRupiah(weeks[1]);
      document.getElementById('week3Total').textContent = formatRupiah(weeks[2]);
      document.getElementById('week4Total').textContent = formatRupiah(weeks[3]);
      
      // Close detail table by default
      document.getElementById('weeklyTableContainer').classList.add('hidden');
    }
    
    function selectWeek(weekNum) {
      const month = parseInt(document.getElementById('weeklyMonth').value);
      const year = parseInt(document.getElementById('weeklyYear').value);
      
      let expenses = allData.filter(d => {
        if (d.type !== 'expense') return false;
        const date = new Date(d.date);
        if (date.getMonth() + 1 !== month || date.getFullYear() !== year) return false;
        return getWeekOfMonth(d.date) === weekNum;
      });
      
      expenses.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      document.getElementById('selectedWeekNum').textContent = weekNum;
      
      const tbody = document.getElementById('weeklyDetailTable');
      let totalNominal = 0;
      
      if (expenses.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-400">Tidak ada data untuk minggu ini</td></tr>';
        document.getElementById('weeklyDetailTotal').textContent = formatRupiah(0);
      } else {
        totalNominal = expenses.reduce((sum, exp) => sum + exp.amount, 0);
        tbody.innerHTML = expenses.map((item, i) => {
          const amountClass = item.amount < 100000 ? 'text-emerald-600' : item.amount < 500000 ? 'text-amber-600' : 'text-rose-600';
          return `
            <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">
              <td class="px-3 py-2.5 border-b border-gray-100">${formatDate(item.date)}</td>
              <td class="px-3 py-2.5 border-b border-gray-100">
                <span class="px-2 py-1 bg-slate-100 rounded-lg text-xs font-medium">${item.category}</span>
              </td>
              <td class="px-3 py-2.5 border-b border-gray-100 text-gray-600">${item.description}</td>
              <td class="px-3 py-2.5 border-b border-gray-100 text-right font-medium ${amountClass}">${formatRupiah(item.amount)}</td>
            </tr>
          `;
        }).join('');
        document.getElementById('weeklyDetailTotal').textContent = formatRupiah(totalNominal);
      }
      
      document.getElementById('weeklyTableContainer').classList.remove('hidden');
    }
    
    function closeWeeklyDetail() {
      document.getElementById('weeklyTableContainer').classList.add('hidden');
    }
    
    function downloadWeeklyReport(weekNum) {
      const month = parseInt(document.getElementById('weeklyMonth').value);
      const year = parseInt(document.getElementById('weeklyYear').value);
      const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      let expenses = allData.filter(d => {
        if (d.type !== 'expense') return false;
        const date = new Date(d.date);
        if (date.getMonth() + 1 !== month || date.getFullYear() !== year) return false;
        return getWeekOfMonth(d.date) === weekNum;
      });
      
      expenses.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      const companyName = config.company_name || defaultConfig.company_name;
      const periodText = `Minggu ke-${weekNum}, ${monthNames[month-1]} ${year}`;
      
      let totalAmount = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      
      let tableRows = expenses.map((item, i) => {
        return `
          <tr>
            <td style="padding:8px;border:1px solid #ddd;text-align:center">${i + 1}</td>
            <td style="padding:8px;border:1px solid #ddd">${formatDate(item.date)}</td>
            <td style="padding:8px;border:1px solid #ddd">${item.category}</td>
            <td style="padding:8px;border:1px solid #ddd">${item.description}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${formatRupiah(item.amount)}</td>
          </tr>
        `;
      }).join('');
      
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Rekap Mingguan - ${companyName}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; }
            .header { text-align: center; margin-bottom: 30px; }
            .logo { width: 80px; height: 80px; background: linear-gradient(135deg, #a855f7, #ec4899, #f43f5e); border-radius: 16px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; }
            h1 { color: #1f2937; margin: 0 0 8px; font-size: 24px; }
            h2 { color: #6b7280; margin: 0 0 8px; font-size: 16px; font-weight: normal; }
            .period { color: #7c3aed; font-weight: bold; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th { background: #f3e8ff; color: #6d28d9; padding: 12px 8px; border: 1px solid #ddd6fe; font-weight: bold; }
            .total-row { background: #f3e8ff; font-weight: bold; }
            @media print { body { padding: 20px; } }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="logo"></div>
            <h1>${companyName}</h1>
            <h2>REKAP PENGELUARAN KAS KECIL</h2>
            <p class="period">Periode: ${periodText}</p>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width:50px">No</th>
                <th>Tanggal</th>
                <th>Kategori</th>
                <th>Uraian</th>
                <th style="width:120px">Nominal</th>
              </tr>
            </thead>
            <tbody>
              ${tableRows || '<tr><td colspan="5" style="text-align:center;padding:20px;color:#9ca3af">Tidak ada data</td></tr>'}
              <tr class="total-row">
                <td colspan="4" style="padding:12px 8px;border:1px solid #ddd6fe;text-align:right">TOTAL:</td>
                <td style="padding:12px 8px;border:1px solid #ddd6fe;text-align:right">${formatRupiah(totalAmount)}</td>
              </tr>
            </tbody>
          </table>
          <div style="margin-top:40px;display:flex;justify-content:space-between">
            <div style="text-align:center">
              <p>Dibuat oleh,</p>
              <div style="height:60px"></div>
              <p style="border-top:1px solid #333;padding-top:8px">Admin Keuangan</p>
            </div>
            <div style="text-align:center">
              <p>Mengetahui,</p>
              <div style="height:60px"></div>
              <p style="border-top:1px solid #333;padding-top:8px">Manager</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Rekap_Mingguan_${weekNum}_${monthNames[month-1]}_${year}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('Laporan rekap mingguan berhasil diunduh!', 'success');
    }
    
    function downloadMonthlyReport() {
      const month = parseInt(document.getElementById('reportMonth').value);
      const year = parseInt(document.getElementById('reportYear').value);
      const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      let filteredData = allData.filter(d => {
        const date = new Date(d.date);
        return date.getMonth() + 1 === month && date.getFullYear() === year;
      });
      
      filteredData.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      const companyName = config.company_name || defaultConfig.company_name;
      const periodText = `${monthNames[month-1]} ${year}`;
      
      let runningBalance = 0;
      let tableRows = filteredData.map((item, i) => {
        const debit = item.type === 'income' ? item.amount : 0;
        const credit = item.type === 'expense' ? item.amount : 0;
        runningBalance += debit - credit;
        
        return `
          <tr>
            <td style="padding:8px;border:1px solid #ddd;text-align:center">${i + 1}</td>
            <td style="padding:8px;border:1px solid #ddd">${formatDate(item.date)}</td>
            <td style="padding:8px;border:1px solid #ddd">${item.type === 'income' ? item.source : item.description}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${debit > 0 ? formatRupiah(debit) : '-'}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${credit > 0 ? formatRupiah(credit) : '-'}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${formatRupiah(runningBalance)}</td>
          </tr>
        `;
      }).join('');
      
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Buku Kas Kecil - ${companyName}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; }
            .header { text-align: center; margin-bottom: 30px; }
            .logo { width: 80px; height: 80px; background: linear-gradient(135deg, #a855f7, #ec4899, #f43f5e); border-radius: 16px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; }
            h1 { color: #1f2937; margin: 0 0 8px; font-size: 24px; }
            h2 { color: #6b7280; margin: 0 0 8px; font-size: 16px; font-weight: normal; }
            .period { color: #7c3aed; font-weight: bold; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th { background: #f3e8ff; color: #6d28d9; padding: 12px 8px; border: 1px solid #ddd6fe; font-weight: bold; }
            @media print { body { padding: 20px; } }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="logo"></div>
            <h1>${companyName}</h1>
            <h2>BUKU KAS KECIL</h2>
            <p class="period">Periode: ${periodText}</p>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width:50px">No</th>
                <th>Tanggal</th>
                <th>Uraian</th>
                <th style="width:120px">Debit</th>
                <th style="width:120px">Kredit</th>
                <th style="width:120px">Saldo</th>
              </tr>
            </thead>
            <tbody>
              ${tableRows || '<tr><td colspan="6" style="text-align:center;padding:20px;color:#9ca3af">Tidak ada data</td></tr>'}
            </tbody>
          </table>
          <div style="margin-top:40px;display:flex;justify-content:space-between">
            <div style="text-align:center">
              <p>Dibuat oleh,</p>
              <div style="height:60px"></div>
              <p style="border-top:1px solid #333;padding-top:8px">Admin Keuangan</p>
            </div>
            <div style="text-align:center">
              <p>Mengetahui,</p>
              <div style="height:60px"></div>
              <p style="border-top:1px solid #333;padding-top:8px">Manager</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Buku_Kas_${monthNames[month-1]}_${year}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('Buku kas bulanan berhasil diunduh!', 'success');
    }
    
    function renderReport() {
      const week = parseInt(document.getElementById('reportWeek').value);
      const month = parseInt(document.getElementById('reportMonth').value);
      const year = parseInt(document.getElementById('reportYear').value);
      
      let filteredData = allData.filter(d => {
        const date = new Date(d.date);
        const matchMonth = date.getMonth() + 1 === month && date.getFullYear() === year;
        if (!matchMonth) return false;
        if (week === 0) return true;
        return getWeekOfMonth(d.date) === week;
      });
      
      // Sort by date
      filteredData.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Calculate running balance and totals
      let runningBalance = 0;
      let totalDebit = 0;
      let totalKredit = 0;
      
      const tbody = document.getElementById('reportTable');
      
      if (filteredData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-400">Tidak ada data untuk periode ini</td></tr>';
        document.getElementById('reportTotalDebit').textContent = formatRupiah(0);
        document.getElementById('reportTotalKredit').textContent = formatRupiah(0);
        document.getElementById('reportTotalBalance').textContent = formatRupiah(0);
      } else {
        tbody.innerHTML = filteredData.map((item, i) => {
          const debit = item.type === 'income' ? item.amount : 0;
          const credit = item.type === 'expense' ? item.amount : 0;
          runningBalance += debit - credit;
          totalDebit += debit;
          totalKredit += credit;
          
          return `
            <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">
              <td class="px-3 py-2.5 border-b border-gray-100 text-center">${i + 1}</td>
              <td class="px-3 py-2.5 border-b border-gray-100">${formatDate(item.date)}</td>
              <td class="px-3 py-2.5 border-b border-gray-100">${item.type === 'income' ? item.source : item.description}</td>
              <td class="px-3 py-2.5 border-b border-gray-100 text-right ${debit > 0 ? 'text-emerald-600 font-medium' : 'text-gray-400'}">${debit > 0 ? formatRupiah(debit) : '-'}</td>
              <td class="px-3 py-2.5 border-b border-gray-100 text-right ${credit > 0 ? 'text-rose-600 font-medium' : 'text-gray-400'}">${credit > 0 ? formatRupiah(credit) : '-'}</td>
              <td class="px-3 py-2.5 border-b border-gray-100 text-right font-medium">${formatRupiah(runningBalance)}</td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('reportTotalDebit').textContent = formatRupiah(totalDebit);
        document.getElementById('reportTotalKredit').textContent = formatRupiah(totalKredit);
        document.getElementById('reportTotalBalance').textContent = formatRupiah(runningBalance);
      }
    }
    
    // Sort table
    function sortTable(type, field) {
      sortConfig[type].asc = sortConfig[type].field === field ? !sortConfig[type].asc : false;
      sortConfig[type].field = field;
      if (type === 'income') renderIncomeTable();
      else renderExpenseTable();
    }
    
    // Search handlers
    document.getElementById('incomeSearch').addEventListener('input', renderIncomeTable);
    document.getElementById('expenseSearch').addEventListener('input', renderExpenseTable);
    
    // Filter change handlers
    document.getElementById('weeklyMonth').addEventListener('change', renderWeeklyRecap);
    document.getElementById('weeklyYear').addEventListener('change', renderWeeklyRecap);
    document.getElementById('reportWeek').addEventListener('change', renderReport);
    document.getElementById('reportMonth').addEventListener('change', renderReport);
    document.getElementById('reportYear').addEventListener('change', renderReport);
    
    // Edit modal
    function openEditModal(id, type) {
      const item = allData.find(d => d.__backendId === id);
      if (!item) return;
      
      document.getElementById('editId').value = id;
      document.getElementById('editType').value = type;
      document.getElementById('editModalTitle').textContent = type === 'income' ? 'Edit Pemasukan' : 'Edit Pengeluaran';
      
      let fieldsHtml = '';
      if (type === 'income') {
        fieldsHtml = `
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
            <input type="date" id="editDate" value="${item.date}" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Sumber</label>
            <input type="text" id="editSource" value="${item.source}" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Nominal</label>
            <input type="number" id="editAmount" value="${item.amount}" min="0" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm text-right">
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Keterangan</label>
            <textarea id="editDesc" rows="2" class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm resize-none">${item.description}</textarea>
          </div>
        `;
      } else {
        const categories = ['Listrik', 'Air', 'Sampah', 'Minum', 'Konsumsi', 'WiFi/Internet', 'Transportasi', 'BBM', 'Pengiriman', 'ATK', 'Pemasaran', 'Pemeliharaan', 'Elektronik', 'Lainnya'];
        fieldsHtml = `
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
            <input type="date" id="editDate" value="${item.date}" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
            <select id="editCategory" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm bg-white">
              ${categories.map(c => `<option value="${c}" ${c === item.category ? 'selected' : ''}>${c}</option>`).join('')}
            </select>
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Uraian</label>
            <input type="text" id="editDesc" value="${item.description}" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm">
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Nominal</label>
            <input type="number" id="editAmount" value="${item.amount}" min="0" required class="w-full px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm text-right">
          </div>
        `;
      }
      
      document.getElementById('editFields').innerHTML = fieldsHtml;
      
      document.getElementById('editModal').classList.remove('hidden');
      document.getElementById('editModal').classList.add('flex');
    }
    
    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
      document.getElementById('editModal').classList.remove('flex');
    }
    
    document.getElementById('editForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const id = document.getElementById('editId').value;
      const type = document.getElementById('editType').value;
      const item = allData.find(d => d.__backendId === id);
      
      if (!item) return;
      
      const updatedItem = { ...item };
      updatedItem.date = document.getElementById('editDate').value;
      updatedItem.amount = parseInt(document.getElementById('editAmount').value) || 0;
      
      if (type === 'income') {
        updatedItem.source = document.getElementById('editSource').value;
        updatedItem.description = document.getElementById('editDesc').value;
      } else {
        updatedItem.category = document.getElementById('editCategory').value;
        updatedItem.description = document.getElementById('editDesc').value;
      }
      
      if (window.dataSdk) {
        const result = await window.dataSdk.update(updatedItem);
        if (result.isOk) {
          showToast('Data berhasil diperbarui!', 'success');
          closeEditModal();
        } else {
          showToast('Gagal memperbarui data!', 'error');
        }
      }
    });
    
    // Delete modal
    function openDeleteModal(id) {
      deleteTarget = id;
      document.getElementById('deleteModal').classList.remove('hidden');
      document.getElementById('deleteModal').classList.add('flex');
    }
    
    function closeDeleteModal() {
      deleteTarget = null;
      document.getElementById('deleteModal').classList.add('hidden');
      document.getElementById('deleteModal').classList.remove('flex');
    }
    
    async function confirmDelete() {
      if (!deleteTarget) return;
      
      const item = allData.find(d => d.__backendId === deleteTarget);
      if (!item) return;
      
      if (window.dataSdk) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
          showToast('Data berhasil dihapus!', 'success');
          closeDeleteModal();
        } else {
          showToast('Gagal menghapus data!', 'error');
        }
      }
    }
    
    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const toastIcon = document.getElementById('toastIcon');
      
      toastMessage.textContent = message;
      
      if (type === 'success') {
        toastIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>';
        toast.firstElementChild.classList.remove('bg-red-600');
        toast.firstElementChild.classList.add('bg-gray-800');
      } else if (type === 'error') {
        toastIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>';
        toast.firstElementChild.classList.remove('bg-gray-800');
        toast.firstElementChild.classList.add('bg-red-600');
      } else {
        toastIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
        toast.firstElementChild.classList.remove('bg-red-600');
        toast.firstElementChild.classList.add('bg-gray-800');
      }
      
      toast.classList.remove('hidden');
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }
    
    // Download report
    function downloadReport(weekNum) {
      downloadReportFormat(weekNum, 'pdf');
    }
    
    // Download report in different formats
    function downloadReportFormat(weekNum, format = 'pdf') {
      const month = parseInt(document.getElementById('downloadMonth').value);
      const year = parseInt(document.getElementById('downloadYear').value);
      const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      
      let filteredData = allData.filter(d => {
        const date = new Date(d.date);
        const matchMonth = date.getMonth() + 1 === month && date.getFullYear() === year;
        if (!matchMonth) return false;
        if (weekNum === 0) return true;
        return getWeekOfMonth(d.date) === weekNum;
      });
      
      filteredData.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      const companyName = config.company_name || defaultConfig.company_name;
      const periodText = weekNum === 0 ? `${monthNames[month-1]} ${year}` : `Minggu ke-${weekNum}, ${monthNames[month-1]} ${year}`;
      
      let runningBalance = 0;
      let tableRows = filteredData.map((item, i) => {
        const debit = item.type === 'income' ? item.amount : 0;
        const credit = item.type === 'expense' ? item.amount : 0;
        runningBalance += debit - credit;
        
        return `
          <tr>
            <td style="padding:8px;border:1px solid #ddd;text-align:center">${i + 1}</td>
            <td style="padding:8px;border:1px solid #ddd">${formatDate(item.date)}</td>
            <td style="padding:8px;border:1px solid #ddd">${item.type === 'income' ? item.source : item.description}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${debit > 0 ? formatRupiah(debit) : '-'}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${credit > 0 ? formatRupiah(credit) : '-'}</td>
            <td style="padding:8px;border:1px solid #ddd;text-align:right">${formatRupiah(runningBalance)}</td>
          </tr>
        `;
      }).join('');
      
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Laporan Kas Kecil - ${companyName}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; }
            .header { text-align: center; margin-bottom: 30px; }
            .logo { width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #14b8a6); border-radius: 16px; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; }
            h1 { color: #1f2937; margin: 0 0 8px; font-size: 24px; }
            h2 { color: #6b7280; margin: 0 0 8px; font-size: 16px; font-weight: normal; }
            .period { color: #059669; font-weight: bold; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th { background: #d1fae5; color: #065f46; padding: 12px 8px; border: 1px solid #a7f3d0; font-weight: bold; }
            @media print { body { padding: 20px; } }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="logo">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h1>${companyName}</h1>
            <h2>LAPORAN BUKU KAS KECIL</h2>
            <p class="period">Periode: ${periodText}</p>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width:50px">No</th>
                <th>Tanggal</th>
                <th>Uraian</th>
                <th style="width:120px">Debit</th>
                <th style="width:120px">Kredit</th>
                <th style="width:120px">Saldo</th>
              </tr>
            </thead>
            <tbody>
              ${tableRows || '<tr><td colspan="6" style="text-align:center;padding:20px;color:#9ca3af">Tidak ada data</td></tr>'}
            </tbody>
          </table>
          <div style="margin-top:40px;display:flex;justify-content:space-between">
            <div style="text-align:center">
              <p>Dibuat oleh,</p>
              <div style="height:60px"></div>
              <p style="border-top:1px solid #333;padding-top:8px">Admin Keuangan</p>
            </div>
            <div style="text-align:center">
              <p>Mengetahui,</p>
              <div style="height:60px"></div>
              <p style="border-top:1px solid #333;padding-top:8px">Manager</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      if (format === 'pdf') {
        // Create HTML file for PDF printing
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Laporan_Kas_Kecil_${weekNum === 0 ? 'Bulanan' : 'Minggu' + weekNum}_${monthNames[month-1]}_${year}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast('File HTML berhasil diunduh! Buka dan cetak sebagai PDF menggunakan browser.', 'success');
      } else if (format === 'word') {
        // Create Word document (docx format using HTML)
        const wordContent = `
          <html xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
          <head>
            <meta charset="UTF-8">
            <title>Laporan Kas Kecil - ${companyName}</title>
            <style>
              @page {
                margin: 40px;
              }
              body {
                font-family: 'Calibri', Arial, sans-serif;
                font-size: 11pt;
              }
              .header {
                text-align: center;
                margin-bottom: 30px;
              }
              h1 {
                font-size: 16pt;
                font-weight: bold;
                color: #1f2937;
                margin: 0 0 5px;
              }
              h2 {
                font-size: 12pt;
                font-weight: normal;
                color: #6b7280;
                margin: 0 0 5px;
              }
              .period {
                font-size: 11pt;
                color: #059669;
                font-weight: bold;
                margin-top: 10px;
              }
              table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
              }
              th {
                background-color: #d1fae5;
                color: #065f46;
                padding: 10px;
                border: 1px solid #a7f3d0;
                font-weight: bold;
                text-align: center;
              }
              td {
                padding: 8px;
                border: 1px solid #ddd;
              }
              .signature {
                margin-top: 40px;
                display: flex;
                justify-content: space-between;
              }
              .signature-box {
                text-align: center;
                width: 40%;
              }
              .signature-box p {
                margin: 0 0 5px;
              }
              .signature-line {
                height: 50px;
                border-bottom: 1px solid #333;
                margin: 20px 0 5px;
              }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>${companyName}</h1>
              <h2>LAPORAN BUKU KAS KECIL</h2>
              <p class="period">Periode: ${periodText}</p>
            </div>
            <table>
              <thead>
                <tr>
                  <th style="width:5%">No</th>
                  <th style="width:15%">Tanggal</th>
                  <th style="width:35%">Uraian</th>
                  <th style="width:15%">Debit</th>
                  <th style="width:15%">Kredit</th>
                  <th style="width:15%">Saldo</th>
                </tr>
              </thead>
              <tbody>
                ${tableRows || '<tr><td colspan="6" style="text-align:center;padding:20px;color:#9ca3af">Tidak ada data</td></tr>'}
              </tbody>
            </table>
            <div class="signature">
              <div class="signature-box">
                <p style="font-weight: bold;">Dibuat oleh,</p>
                <div class="signature-line"></div>
                <p>Admin Keuangan</p>
              </div>
              <div class="signature-box">
                <p style="font-weight: bold;">Mengetahui,</p>
                <div class="signature-line"></div>
                <p>Manager</p>
              </div>
            </div>
          </body>
          </html>
        `;
        
        const blob = new Blob([wordContent], { type: 'application/msword' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Laporan_Kas_Kecil_${weekNum === 0 ? 'Bulanan' : 'Minggu' + weekNum}_${monthNames[month-1]}_${year}.doc`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast('File Word berhasil diunduh!', 'success');
      }
    }
    
    // Initialize year dropdowns
    function initYearDropdowns() {
      const currentYear = new Date().getFullYear();
      const years = [];
      // Generate years from current - 50 up to 3000
      for (let y = currentYear - 50; y <= 3000; y++) {
        years.push(y);
      }
      
      // Setup year input with dropdown for Rekap Mingguan
      setupYearInput('weeklyYear', 'weeklyYearDropdown', years, currentYear);
      
      // Setup year input with dropdown for Buku Kas
      setupYearInput('reportYear', 'reportYearDropdown', years, currentYear);
      
      // Setup year input with dropdown for Download
      setupYearInput('downloadYear', 'downloadYearDropdown', years, currentYear);
      
      // Set current month
      const currentMonth = new Date().getMonth() + 1;
      document.getElementById('weeklyMonth').value = currentMonth;
      document.getElementById('reportMonth').value = currentMonth;
      document.getElementById('downloadMonth').value = currentMonth;
    }
    
    function setupYearInput(inputId, dropdownId, years, currentYear) {
      const input = document.getElementById(inputId);
      const dropdown = document.getElementById(dropdownId);
      
      // Set initial value
      input.value = currentYear;
      
      // Render dropdown options
      function renderDropdown(filter = '') {
        let filtered = years;
        
        if (filter) {
          filtered = years.filter(y => y.toString().startsWith(filter));
        }
        
        // Limit display to 20 items for performance
        const displayed = filtered.slice(0, 20);
        
        dropdown.innerHTML = displayed.map(y => `
          <div class="px-3 py-2 hover:bg-emerald-100 cursor-pointer text-sm transition-colors" onclick="setYearValue('${inputId}', '${dropdownId}', ${y})">${y}</div>
        `).join('');
        
        if (filtered.length === 0) {
          dropdown.innerHTML = '<div class="px-3 py-2 text-gray-400 text-sm">Tidak ada tahun</div>';
        } else if (filtered.length > 20) {
          dropdown.innerHTML += '<div class="px-3 py-2 text-gray-500 text-xs italic">... dan ' + (filtered.length - 20) + ' tahun lagi</div>';
        }
      }
      
      // Show dropdown on focus
      input.addEventListener('focus', function() {
        dropdown.classList.remove('hidden');
        renderDropdown(this.value);
      });
      
      // Filter dropdown on input
      input.addEventListener('input', function() {
        renderDropdown(this.value);
      });
      
      // Handle Enter key to confirm
      input.addEventListener('keydown', function(e) {
        // Allow numbers only
        if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Enter'].includes(e.key)) {
          e.preventDefault();
        }
        
        // On Enter, confirm the year
        if (e.key === 'Enter') {
          const yearValue = parseInt(this.value);
          if (yearValue >= 1900 && yearValue <= 3000) {
            this.value = yearValue;
            dropdown.classList.add('hidden');
            const event = new Event('change', { bubbles: true });
            this.dispatchEvent(event);
          } else {
            showToast('Tahun harus antara 1900-3000', 'error');
          }
        }
      });
      
      // Hide dropdown on blur
      input.addEventListener('blur', function() {
        setTimeout(() => {
          dropdown.classList.add('hidden');
        }, 200);
      });
    }
    
    function setYearValue(inputId, dropdownId, year) {
      document.getElementById(inputId).value = year;
      document.getElementById(dropdownId).classList.add('hidden');
      
      // Trigger change event for rendering
      const event = new Event('change', { bubbles: true });
      document.getElementById(inputId).dispatchEvent(event);
    }
    
    // Initialize dates
    function initDates() {
      const today = getCurrentDate();
      document.getElementById('incomeDate').value = today;
      document.getElementById('expenseDate').value = today;
    }
    
    // Initialize
    initYearDropdowns();
    initDates();
    updateUI();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c894b65745644c3',t:'MTc3MDE5ODk0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>